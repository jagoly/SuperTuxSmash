image: Visual Studio 2019

before_build:

  - cd c:\projects
  - curl -fsSL -o vulkan-sdk.exe https://sdk.lunarg.com/sdk/download/1.2.170.0/windows/VulkanSDK-1.2.170.0-Installer.exe
  - vulkan-sdk.exe /S
  - set VULKAN_SDK=c:\VulkanSDK\1.2.170.0
  - set PATH=c:\VulkanSDK\1.2.170.0\Bin;%PATH%

  - cd c:\projects
  - git clone --depth 1 --branch master https://github.com/SFML/SFML.git
  - cd c:\projects\SFML
  - cmake . -DBUILD_SHARED_LIBS=False -DSFML_USE_STATIC_STD_LIBS=True -DSFML_BUILD_AUDIO=False -DSFML_BUILD_GRAPHICS=False -DSFML_BUILD_NETWORK=False
#  - cmake . -DBUILD_SHARED_LIBS=True -DSFML_USE_STATIC_STD_LIBS=False -DSFML_BUILD_AUDIO=False -DSFML_BUILD_GRAPHICS=False -DSFML_BUILD_NETWORK=False
  - cmake --build . --config Debug

  - cd c:\projects
  - git clone --depth 1 --branch 3.3.4 https://github.com/glfw/glfw.git
  - cd c:\projects\glfw
  - cmake . -DBUILD_SHARED_LIBS=False -DUSE_MSVC_RUNTIME_LIBRARY_DLL=False -DGLFW_BUILD_DOCS=False -DGLFW_BUILD_EXAMPLES=False -DGLFW_BUILD_TESTS=False -DCMAKE_INSTALL_PREFIX=.
#  - cmake . -DBUILD_SHARED_LIBS=True -DUSE_MSVC_RUNTIME_LIBRARY_DLL=True -DGLFW_BUILD_DOCS=False -DGLFW_BUILD_EXAMPLES=False -DGLFW_BUILD_TESTS=False -DCMAKE_INSTALL_PREFIX=.
  - cmake --build . --config Debug --target install

  - cd c:\projects
  - git clone --depth 1 --branch vulkan https://github.com/jagoly/sqee.git
  - cd c:\projects\sqee
  - git submodule update --init --recursive
  - cmake . -DCMAKE_PREFIX_PATH=c:/projects/SFML;c:/projects/glfw -DSQEE_STATIC_LIB=True -G "Visual Studio 16 2019" -A x64
#  - cmake . -DCMAKE_PREFIX_PATH=c:/projects/SFML;c:/projects/glfw -DSQEE_STATIC_LIB=False -G "Visual Studio 16 2019" -A x64
  - cmake --build . --target sqee --config Debug

build_script:

  - mkdir c:\projects\SuperTuxSmash\build
  - cd c:\projects\SuperTuxSmash\build
  - cmake .. -DSQEE_BUILD_ROOT=c:/projects/sqee -G "Visual Studio 16 2019" -A x64
  - cmake --build . --config Debug

after_build:

  - mkdir c:\out

  - cd c:\projects\SuperTuxSmash\build
  - xcopy /E assets c:\out\assets\
  - xcopy /E shaders c:\out\shaders\
  - xcopy /E wren c:\out\wren\
  - xcopy /E config c:\out\config\
  - copy Debug\sts-game.exe c:\out

  - cd c:\
  - rename out sts-windows-debug
  - 7z a sts-windows-debug.zip sts-windows-debug

  - move sts-windows-debug.zip c:\projects\SuperTuxSmash

artifacts:

  - path: sts-windows-debug.zip
    name: sts-windows-debug

