image: Visual Studio 2019

before_build:

  - cd c:/projects
  - curl -fsSL -o vulkan-sdk.exe https://sdk.lunarg.com/sdk/download/1.2.189.2/windows/VulkanSDK-1.2.189.2-Installer.exe
  - vulkan-sdk.exe --accept-licenses --default-answer --confirm-command install
  - set VULKAN_SDK=c:/VulkanSDK/1.2.189.2
  - set PATH=c:/VulkanSDK/1.2.189.2/Bin;%PATH%

  - cd c:/projects
  - git clone --depth 1 --branch 3.3.4 https://github.com/glfw/glfw.git
  - cd c:/projects/glfw
  - cmake . -DBUILD_SHARED_LIBS=False -DUSE_MSVC_RUNTIME_LIBRARY_DLL=False -DGLFW_BUILD_DOCS=False -DGLFW_BUILD_EXAMPLES=False -DGLFW_BUILD_TESTS=False -DCMAKE_INSTALL_PREFIX=.
  - cmake --build . --target install --config Debug

  - cd c:/projects
  - git clone --depth 1 --branch master https://github.com/jagoly/sqee.git
  - cd c:/projects/sqee
  - git submodule update --init --recursive
  - cmake . -DCMAKE_PREFIX_PATH=c:/projects/glfw -DSQEE_STATIC_LIB=True -G "Visual Studio 16 2019" -A x64
  - cmake --build . --target sqee --config Debug

build_script:

  - mkdir c:\projects\SuperTuxSmash\build
  - cd c:/projects/SuperTuxSmash/build
  - cmake .. -DSQEE_BUILD_ROOT=c:/projects/sqee -G "Visual Studio 16 2019" -A x64
  - cmake --build . --config Debug

after_build:

  - cd c:/projects/SuperTuxSmash/build
  - 7z a sts-windows-debug.zip Debug/*

artifacts:

  - path: build/sts-windows-debug.zip
    name: sts-windows-debug
